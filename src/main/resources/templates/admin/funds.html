<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>All Funds</title>
<th:block th:replace="admin/fragments :: css"></th:block>
<th:block th:replace="admin/fragments :: scripts"></th:block>
</head>
<body>
	<th:block th:insert="admin/admin-dashboard :: header"></th:block>
	<th:block th:insert="admin/admin-dashboard :: logo"></th:block>
	<th:block th:insert="admin/admin-dashboard :: sidebar"></th:block>

	<div class="br-mainpanel">
		<div class="br-pagetitle pt-0 flex justify-content-space-around">
			<i class="icon ion-ios-people-outline"></i>
			<div>
				<h4>Funds</h4>
				<p class="mg-b-0">A Detailed List Of Your Funds</p>
			</div>
		</div>

		<div class="br-pagebody mt-0">
			<div class="br-section-wrapper pd-20">
				<div class="mt-0 my-1 mx-0 d-flex justify-content-end">
					<div class="mt-0 my-1 mx-0">
						<a th:href="@{/admin/add-fund}" class="btn btn-teal mt-0">Add
							Fund</a>
					</div>
				</div>

				<!-- Filter Form -->
				<form th:action="@{/admin/funds}" method="get" class="mb-4"
					id="filterForm">
					<div class="row">
						<!-- Category Filter -->
						<div class="col-md-3">
							<label>Employee:</label> <select name="employeeId"
								class="form-control">
								<option value="">All</option>
								<option th:each="cat : ${allEmployees}"
									th:if="${cat.role=='USER'}" th:value="${cat.employeeId}"
									th:text="${cat.employeeName+'-'+cat.employeeId}"></option>
							</select>
						</div>

						<!-- Name Filter -->
						<div class="col-md-3">
							<label>Fund Type:</label> <select name="fundType"
								class="form-control">
								<option value="">All</option>
								<option th:each="fundType : ${fundTypes}" th:value="${fundType}"
									th:text="${fundType}"
									th:selected="${selectedfundType == fundType}">
								</option>
							</select>
						</div>


						<!-- From Date -->
						<div class="col-md-3">
							<label>From Date:</label> <input type="date" name="fromDate"
								class="form-control" id="fromDate"
								th:value="${selectedFromDate}">
						</div>

						<!-- To Date -->
						<div class="col-md-3">
							<label>To Date:</label> <input type="date" name="toDate"
								class="form-control" id="toDate" th:value="${selectedToDate}">
						</div>

						<!-- Payment Type -->
						<!-- 	<div class="col-md-3 mt-2">
							<label>Payment Type:</label> <select name="paymentType"
								class="form-control">
								<option value="">All</option>
								<option th:each="type : ${paymentTypes}" th:value="${type}"
									th:text="${type}"
									th:selected="${selectedPaymentType != null and selectedPaymentType == type}">
								</option>
							</select>

						</div> -->
					</div>

					<div class="mt-3">
						<button type="submit" class="btn btn-primary">Filter</button>
						<a th:href="@{/admin/funds}" class="btn btn-secondary">Reset</a>
					</div>
					<div class="mt-3">
						<h5>
							Total Amount: <span
								th:text="${selectedfundType}"></span>
						</h5>
					</div>

				</form>

				<!-- Expense Table -->
				<div class="table-wrapper">
					<table id="datatable1"
						class="table display table-responsive nowrap">
						<thead>
							<tr>
								<th>#</th>
								<th>Employee Id</th>
								<th>Employee Name</th>
								<th>Fund Amount</th>
								<th>Fund Type</th>
								<th>Payment Type</th>
								<th>Credit Amount</th>
								<th>Debit Amount</th>
								<th>Balance</th>
								<th>Requested Date</th>
								<th>Approved By</th>
								<th>Approval Date</th>
								<th>Entry Date</th>
								<th>Remarks</th>
								<th>Status</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="fund, stat : ${funds}">
								<td
									th:text="${stat.index + 1 + ((currentPage != null ? currentPage : 0) * (size != null ? size : 10))}"></td>
								<td th:text="${fund.employee.employeeId}"></td>
								<td th:text="${fund.employee.employeeName}"></td>
								<td th:text="${fund.fundAmount}"></td>
								<td th:text="${fund.fundType}"></td>
								<td th:text="${fund.paymentType}"></td>

								<td th:text="${fund.creditAmount}"></td>
								<td th:text="${fund.debitAmount}"></td>
								<td th:text="${fund.balance}"></td>

								<td th:text="${#temporals.format(fund.requested, 'dd-MM-yyyy')}"></td>

								<td th:text="${fund.approvedBy}"></td>
								<td
									th:text="${#temporals.format(fund.approvalDate, 'dd-MM-yyyy')}"></td>
								<td th:text="${#temporals.format(fund.entryDate, 'dd-MM-yyyy')}"></td>
								<td th:text="${fund.remarks}"></td>
								<td th:text="${fund.status}"></td>

								<td class="d-flex justify-content-center"><a
									th:href="@{/admin/edit-fund/{id}(id=${fund.fundId})}"
									class="btn btn-primary btn-icon ht-28 wd-30 pd-3 mx-1"> <i
										class="fas fa-edit"></i>
								</a>
									<form th:action="@{/admin/delete-fund/{id}(id=${fund.fundId})}"
										method="post">
										<input type="hidden" name="_method" value="delete" />
										<button type="button" class="btn btn-danger"
											onclick="confirmDelete(event)">
											<i class="fas fa-trash "></i>
										</button>
									</form></td>
							</tr>
						</tbody>
					</table>
				</div>


				<!-- Pagination -->
				<nav aria-label="navigation" class="table">
					<ul class="pagination d-flex mx-2 flex-wrap">

						<li class="page-item"
							th:classappend="${currentPage == 0} ? 'disabled'"><a
							class="page-link"
							th:href="@{/admin/funds(page=${currentPage - 1}, size=${size}, 
                                  category=${selectedCategory}, 
                                  name=${selectedName}, 
                                  fromDate=${selectedFromDate}, 
                                  toDate=${selectedToDate}, 
                                  paymentType=${selectedPaymentType})}">&laquo;</a>
						</li>

						<li class="page-item"
							th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
							th:classappend="${currentPage == i} ? 'active'"><a
							class="page-link"
							th:href="@{/admin/funds(page=${i}, size=${size}, 
                                  category=${selectedCategory}, 
                                  name=${selectedName}, 
                                  fromDate=${selectedFromDate}, 
                                  toDate=${selectedToDate}, 
                                  paymentType=${selectedPaymentType})}"
							th:text="${i + 1}"></a></li>


						<li class="page-item"
							th:classappend="${currentPage + 1 == totalPages} ? 'disabled'">
							<a class="page-link"
							th:href="@{/admin/funds(page=${currentPage + 1}, size=${size}, 
                                  category=${selectedCategory}, 
                                  name=${selectedName}, 
                                  fromDate=${selectedFromDate}, 
                                  toDate=${selectedToDate}, 
                                  paymentType=${selectedPaymentType})}">&raquo;</a>
						</li>
					</ul>
				</nav>
			</div>
		</div>
	</div>
	<th:block th:insert="admin/admin-dashboard :: footer"></th:block>


	<div th:if="${success}">
		<script th:inline="javascript">
                              document.addEventListener("DOMContentLoaded", function () {
                               $.SweetAlert.showSuccess(/*[[${success}]]*/);
                               });
                              </script>
	</div>
	<div th:if="${error}">
		<script th:inline="javascript">
                              document.addEventListener("DOMContentLoaded", function () {
                               $.SweetAlert.showError(/*[[${error}]]*/);
                               });
                              </script>

	</div>




	<!-- Delete Confirmation -->
	<script>
        function confirmDelete(event) {
            event.preventDefault();
            Swal.fire({
                title: "Are you sure?",
                text: "You won't be able to revert this!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Yes, delete it!"
            }).then((result) => {
                if (result.isConfirmed) {
                    event.target.closest("form").submit();
                }
            });
        }

        document.addEventListener("DOMContentLoaded", function () {
            let today = new Date().toISOString().split("T")[0];
            document.getElementById("fromDate").setAttribute("max", today);
            document.getElementById("toDate").setAttribute("max", today);
        });
    </script>
	<script>
		$(function() {
			'use strict';

			$('#datatable1').DataTable({
				responsive : false,
				language : {
					searchPlaceholder : 'Search...',
					sSearch : '',
					lengthMenu : '_MENU_ items/page',
				}
			});

			$('#datatable2').DataTable({
				bLengthChange : false,
				searching : false,
				responsive : true
			});

			// Select2
			$('.dataTables_length select').select2({
				minimumResultsForSearch : Infinity
			});
		});
	</script>
</body>
</html>
